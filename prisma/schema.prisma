// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Investor {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  name     String
  password String
  tax_id   String  @unique
  wallet   Wallet?
}

model Wallet {
  id            Int                 @id @default(autoincrement())
  totalInvested Decimal
  active        Boolean             @default(false)
  investor      Investor            @relation(fields: [investorId], references: [id])
  investorId    Int                 @unique
  transactions  TransactionRecord[]
  assets        AssetWallet[]
}

model TransactionRecord {
  id       Int      @id @default(autoincrement())
  date     DateTime
  value    Decimal
  wallet   Wallet   @relation(fields: [walletId], references: [id])
  walletId Int
  createdAt    DateTime @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime @updatedAt @db.Timestamptz(6)
}

model AssetWallet {
  id       Int       @id @default(autoincrement())
  ticker   Int
  walletId Int
  boughtAt DateTime
  soldAt   DateTime?
  profit   Decimal?
  quantity Int

  asset  Asset  @relation(fields: [ticker], references: [id])
  wallet Wallet @relation(fields: [walletId], references: [id])

  orders Order[]

  @@unique([ticker, walletId])
}

model Order {
  id            Int         @id @default(autoincrement())
  status        String
  price         Decimal
  quantity      Int
  assetWallet   AssetWallet @relation(fields: [assetWalletId], references: [id])
  assetWalletId Int
}

model Asset {
  id             Int      @id @default(autoincrement())
  ticker         String   @unique
  volume         Int
  dailyVariation Decimal
  bbi            Decimal
  rsi            Int?
  scom           Decimal?
  sven           Decimal
  assetName      String
  type           String
  benchmark      String
  date           DateTime
  price          Decimal
  pl             Decimal
  macdim         Decimal
  macdis         Decimal
  macdh          Decimal
  bbs            Decimal
  bbl            Decimal
  bbm            Decimal
  rsicom         Decimal
  rsivem         Decimal

  assetWallets AssetWallet[]
}
